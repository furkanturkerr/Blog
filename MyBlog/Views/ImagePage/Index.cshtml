@model List<Entities.Concrate.ImagesPage>
@{
    ViewData["Title"] = "Servisler";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Görseller</h2>
    <div>
        <a class="btn btn-success" asp-action="AddImage">Görsel Yükle</a>
    </div>
</div>

<form method="get" class="mb-3">
    <div class="input-group">
        <input name="q" class="form-control" placeholder="Ara: dosya adı, title, alt, keywords..." value="@Context.Request.Query["q"]" />
        <button class="btn btn-outline-secondary" type="submit">Ara</button>
    </div>
</form>

@if (!Model.Any())
{
    <div class="alert alert-info">Henüz görsel yok.</div>
}
else
{
    <div class="table-responsive">
        <table class="table align-middle">
            <thead class="table-light">
                <tr>
                    <th style="width:70px;">ID</th>
                    <th style="width:120px;">Önizleme</th>
                    <th>Dosya</th>
                    <th>ALT</th>
                    <th>Title</th>
                    <th>Slug</th>
                    <th>Keywords</th>
                    <th>Description</th>
                    <th style="width:150px;">İşlemler</th>
                </tr>
            </thead>
           <tbody>
@foreach (var x in Model)
{
    <tr>
        <td>@x.Id</td>
        <td>
            <img src="@x.FilePath" alt="@x.AltText"
                 style="width:110px;height:70px;object-fit:cover;border-radius:6px;border:1px solid #eee;" />
        </td>
        <td>
            <div class="small text-muted">@x.FileName</div>
            <div class="small">@x.FileType • @(Math.Round((x.FileSize/1024.0),1)) KB</div>
            <div class="small text-muted">@x.UploadDate.ToLocalTime()</div>
        </td>

        @* 1) Satıra ait gizli form *@
        <td style="display:none;">
            <form id="f-@x.Id" asp-action="UpdateSeo" method="post">
                @Html.AntiForgeryToken()
                <input type="hidden" name="id" value="@x.Id" />
            </form>
        </td>

        @* 2) Tüm inputları bu forma bağla *@
        <td>
            <input class="form-control form-control-sm" name="altText" value="@x.AltText"
                   placeholder="ALT" form="f-@x.Id" />
        </td>
        <td>
            <input class="form-control form-control-sm" name="title" value="@x.Title"
                   placeholder="Title" form="f-@x.Id" />
        </td>
        <td>
            <div class="input-group input-group-sm">
                <input class="form-control" name="seoSlug" value="@x.SeoSlug"
                       placeholder="seo-slug" form="f-@x.Id" />
                <button class="btn btn-outline-secondary" type="button"
                        onclick="slugifyRow(this)">Oto</button>
            </div>
        </td>
        <td>
            <input class="form-control form-control-sm" name="keywords" value="@x.Keywords"
                   placeholder="virgüllerle ayırın" form="f-@x.Id" />
        </td>
        <td>
            <input class="form-control form-control-sm" name="description" value="@x.Description"
                   placeholder="Kısa açıklama" form="f-@x.Id" />
            <div class="form-check mt-1">
                <input class="form-check-input" type="checkbox" name="isActive" value="true"
                       @(x.IsActive ? "checked" : "") form="f-@x.Id" />
                <label class="form-check-label small">Aktif</label>
            </div>
        </td>
        <td class="text-nowrap">
            <button class="btn btn-primary btn-sm" type="submit" form="f-@x.Id">Kaydet</button>
            <a asp-action="Delete" asp-route-id="@x.Id" class="btn btn-outline-danger btn-sm"
               onclick="return confirm('Silinsin mi?')">Sil</a>
        </td>
    </tr>
}
</tbody>

        </table>
    </div>
}


<script>
function slugify(str){
    if(!str) return '';
    let s = str.toLowerCase()
        .replace(/ı/g,'i').replace(/ğ/g,'g').replace(/ü/g,'u')
        .replace(/ş/g,'s').replace(/ö/g,'o').replace(/ç/g,'c')
        .replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
    return s;
}
function slugifyRow(btn){
    const row = btn.closest('tr');
    const titleInput = row.querySelector('input[name="title"]');
    const slugInput  = row.querySelector('input[name="seoSlug"]');
    slugInput.value = slugify(titleInput.value);
}
</script>
}
